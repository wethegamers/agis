<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>My Servers - WeTheGamers</title>
    <!-- Tabler CSS -->
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/css/tabler.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@2.44.0/dist/tabler-icons.min.css" rel="stylesheet"/>
    <style>
      @import url('https://rsms.me/inter/inter.css');
      :root {
      	--tblr-font-sans-serif: 'Inter Var', -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif;
      }
      body {
      	font-feature-settings: "cv03", "cv04", "cv11";
      }
      .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 6px;
      }
      .status-running { background: #2fb344; }
      .status-stopped { background: #6c757d; }
      .status-creating { background: #f59f00; animation: pulse 1.5s infinite; }
      .status-error { background: #d63939; }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
      .game-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        font-weight: bold;
        color: white;
      }
      .game-minecraft { background: linear-gradient(135deg, #62a83e, #4e8431); }
      .game-cs2 { background: linear-gradient(135deg, #f59f00, #d38300); }
      .game-terraria { background: linear-gradient(135deg, #17a2b8, #117a8b); }
      .game-gmod { background: linear-gradient(135deg, #f76707, #d35400); }
      .game-default { background: linear-gradient(135deg, #667eea, #764ba2); }
    </style>
  </head>
  <body>
    <div class="page">
      <!-- Navbar -->
      <header class="navbar navbar-expand-md navbar-light d-print-none">
        <div class="container-xl">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-menu">
            <span class="navbar-toggler-icon"></span>
          </button>
          <h1 class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal pe-0 pe-md-3">
            <a href="/">
              <span class="avatar bg-primary text-white">WTG</span>
              WeTheGamers
            </a>
          </h1>
          <div class="navbar-nav flex-row order-md-last">
            <div class="nav-item d-none d-md-flex me-3">
              <div class="btn-list">
                <a href="/ads" class="btn btn-ghost-secondary">
                  <i class="ti ti-coin icon"></i>
                  Earn Credits
                </a>
              </div>
            </div>
            <div class="nav-item dropdown">
              <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown">
                <span class="avatar avatar-sm bg-primary-lt">{{substr .UserID 0 2}}</span>
                <div class="d-none d-xl-block ps-2">
                  <div>{{.Username}}</div>
                  <div class="mt-1 small text-secondary">{{.Credits}} GC</div>
                </div>
              </a>
              <div class="dropdown-menu dropdown-menu-end">
                <a href="/profile" class="dropdown-item">Profile</a>
                <a href="/billing" class="dropdown-item">Billing</a>
                <div class="dropdown-divider"></div>
                <a href="/logout" class="dropdown-item">Logout</a>
              </div>
            </div>
          </div>
        </div>
      </header>
      
      <div class="page-wrapper">
        <!-- Page header -->
        <div class="page-header d-print-none">
          <div class="container-xl">
            <div class="row g-2 align-items-center">
              <div class="col">
                <div class="page-pretitle">Dashboard</div>
                <h2 class="page-title">My Game Servers</h2>
              </div>
              <div class="col-auto ms-auto d-print-none">
                <div class="btn-list">
                  <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal-create-server">
                    <i class="ti ti-plus icon"></i>
                    Create Server
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Page body -->
        <div class="page-body">
          <div class="container-xl">
            <!-- Quick Stats -->
            <div class="row row-cards mb-3">
              <div class="col-sm-6 col-lg-3">
                <div class="card card-sm">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <span class="bg-primary text-white avatar">
                          <i class="ti ti-server"></i>
                        </span>
                      </div>
                      <div class="col">
                        <div class="font-weight-medium">Active Servers</div>
                        <div class="text-secondary">{{.ActiveServers}} / {{.TotalServers}}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-lg-3">
                <div class="card card-sm">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <span class="bg-success text-white avatar">
                          <i class="ti ti-coin"></i>
                        </span>
                      </div>
                      <div class="col">
                        <div class="font-weight-medium">Credits Balance</div>
                        <div class="text-secondary">{{.Credits}} GC</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-lg-3">
                <div class="card card-sm">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <span class="bg-info text-white avatar">
                          <i class="ti ti-clock"></i>
                        </span>
                      </div>
                      <div class="col">
                        <div class="font-weight-medium">Total Uptime</div>
                        <div class="text-secondary">{{.TotalUptime}}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-lg-3">
                <div class="card card-sm">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <span class="bg-warning text-white avatar">
                          <i class="ti ti-bolt"></i>
                        </span>
                      </div>
                      <div class="col">
                        <div class="font-weight-medium">Total Spent</div>
                        <div class="text-secondary">{{.TotalSpent}} GC</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Servers List -->
            <div class="row row-cards">
              {{range .Servers}}
              <div class="col-md-6 col-lg-4">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                      <div class="game-icon game-{{.GameType}}">
                        {{if eq .GameType "minecraft"}}‚õèÔ∏è{{else if eq .GameType "cs2"}}üî´{{else if eq .GameType "terraria"}}üó°Ô∏è{{else if eq .GameType "gmod"}}üîß{{else}}üéÆ{{end}}
                      </div>
                      <div class="ms-3 flex-fill">
                        <h3 class="card-title mb-1">{{.Name}}</h3>
                        <div class="text-secondary small">
                          <span class="status-indicator status-{{.Status}}"></span>
                          {{.Status}}
                        </div>
                      </div>
                      <div class="dropdown">
                        <button class="btn btn-ghost-secondary btn-icon" data-bs-toggle="dropdown">
                          <i class="ti ti-dots-vertical"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end">
                          {{if eq .Status "running"}}
                          <a href="#" class="dropdown-item" onclick="stopServer({{.ID}})">
                            <i class="ti ti-player-pause me-2"></i>Stop
                          </a>
                          <a href="#" class="dropdown-item" onclick="restartServer({{.ID}})">
                            <i class="ti ti-refresh me-2"></i>Restart
                          </a>
                          {{else if eq .Status "stopped"}}
                          <a href="#" class="dropdown-item" onclick="startServer({{.ID}})">
                            <i class="ti ti-player-play me-2"></i>Start
                          </a>
                          {{end}}
                          <a href="/servers/{{.ID}}" class="dropdown-item">
                            <i class="ti ti-settings me-2"></i>Settings
                          </a>
                          <div class="dropdown-divider"></div>
                          <a href="#" class="dropdown-item text-danger" onclick="deleteServer({{.ID}})">
                            <i class="ti ti-trash me-2"></i>Delete
                          </a>
                        </div>
                      </div>
                    </div>

                    {{if .Address}}
                    <div class="mb-3">
                      <div class="row">
                        <div class="col">
                          <div class="text-secondary small mb-1">Address</div>
                          <div class="font-monospace small">{{.Address}}:{{.Port}}</div>
                        </div>
                        <div class="col-auto">
                          <button class="btn btn-sm btn-ghost-secondary" onclick="copyAddress('{{.Address}}:{{.Port}}')">
                            <i class="ti ti-copy"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                    {{end}}

                    <div class="row">
                      <div class="col-6">
                        <div class="text-secondary small">Cost</div>
                        <div>{{.CostPerHour}} GC/hr</div>
                      </div>
                      <div class="col-6">
                        <div class="text-secondary small">Uptime</div>
                        <div>{{.Uptime}}</div>
                      </div>
                    </div>

                    {{if eq .Status "running"}}
                    <div class="mt-3 pt-3 border-top">
                      <div class="btn-list">
                        <a href="/servers/{{.ID}}/console" class="btn btn-sm w-100">
                          <i class="ti ti-terminal me-2"></i>Console
                        </a>
                      </div>
                    </div>
                    {{end}}
                  </div>
                </div>
              </div>
              {{else}}
              <div class="col-12">
                <div class="card">
                  <div class="empty">
                    <div class="empty-img"><img src="https://tabler.io/demo/static/illustrations/undraw_server_down_s-4-lk.svg" height="128" alt=""></div>
                    <p class="empty-title">No servers yet</p>
                    <p class="empty-subtitle text-secondary">
                      Get started by creating your first game server
                    </p>
                    <div class="empty-action">
                      <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal-create-server">
                        <i class="ti ti-plus icon"></i>
                        Create Server
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              {{end}}
            </div>
          </div>
        </div>

        <!-- Footer -->
        <footer class="footer footer-transparent d-print-none">
          <div class="container-xl">
            <div class="row text-center align-items-center flex-row-reverse">
              <div class="col-lg-auto ms-lg-auto">
                <ul class="list-inline list-inline-dots mb-0">
                  <li class="list-inline-item"><a href="/docs" class="link-secondary">Documentation</a></li>
                  <li class="list-inline-item"><a href="/support" class="link-secondary">Support</a></li>
                </ul>
              </div>
              <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                <ul class="list-inline list-inline-dots mb-0">
                  <li class="list-inline-item">
                    Copyright &copy; 2025 WeTheGamers
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>

    <!-- Create Server Modal -->
    <div class="modal modal-blur fade" id="modal-create-server" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Create New Server</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="create-server-form">
              <div class="mb-3">
                <label class="form-label required">Game Type</label>
                <select class="form-select" name="game_type" required>
                  <option value="">Select a game...</option>
                  <option value="minecraft">Minecraft (5 GC/hr)</option>
                  <option value="cs2">Counter-Strike 2 (8 GC/hr)</option>
                  <option value="terraria">Terraria (3 GC/hr)</option>
                  <option value="gmod">Garry's Mod (6 GC/hr)</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label required">Server Name</label>
                <input type="text" class="form-control" name="name" placeholder="my-awesome-server" required>
                <small class="form-hint">Use lowercase letters, numbers, and hyphens only</small>
              </div>
              <div class="mb-3">
                <label class="form-label">Description (optional)</label>
                <textarea class="form-control" name="description" rows="3" placeholder="A fun server for friends"></textarea>
              </div>
              <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" name="is_public" id="switch-public">
                <label class="form-check-label" for="switch-public">Make server public</label>
              </div>
              <div class="alert alert-info">
                <i class="ti ti-info-circle me-2"></i>
                Your current balance: <strong>{{.Credits}} GC</strong>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-link link-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="createServer()">Create Server</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabler JS -->
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/js/tabler.min.js"></script>
    <script>
      // API functions
      function copyAddress(address) {
        navigator.clipboard.writeText(address);
        // TODO: Show toast notification
      }

      function createServer() {
        const form = document.getElementById('create-server-form');
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        
        fetch('/api/v1/servers', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          },
          body: JSON.stringify(data)
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            window.location.reload();
          } else {
            alert('Error: ' + data.error);
          }
        });
      }

      function startServer(id) {
        if (!confirm('Start this server?')) return;
        fetch(`/api/v1/servers/${id}/start`, {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
        }).then(() => window.location.reload());
      }

      function stopServer(id) {
        if (!confirm('Stop this server? You can start it again later.')) return;
        fetch(`/api/v1/servers/${id}/stop`, {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
        }).then(() => window.location.reload());
      }

      function restartServer(id) {
        if (!confirm('Restart this server?')) return;
        fetch(`/api/v1/servers/${id}/restart`, {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
        }).then(() => window.location.reload());
      }

      function deleteServer(id) {
        if (!confirm('Delete this server permanently? This cannot be undone.')) return;
        fetch(`/api/v1/servers/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
        }).then(() => window.location.reload());
      }

      // Auto-refresh every 30 seconds
      setTimeout(() => window.location.reload(), 30000);
    </script>
  </body>
</html>
