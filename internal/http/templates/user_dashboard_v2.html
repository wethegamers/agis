<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>My Servers - WeTheGamers Pro</title>
    <!-- Tabler CSS -->
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/css/tabler.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@2.44.0/dist/tabler-icons.min.css" rel="stylesheet"/>
    <!-- Chart.js for real-time graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
      @import url('https://rsms.me/inter/inter.css');
      :root {
      	--tblr-font-sans-serif: 'Inter Var', -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif;
      }
      body {
      	font-feature-settings: "cv03", "cv04", "cv11";
      }
      .server-card {
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
      }
      .server-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      }
      .server-status-badge {
        position: absolute;
        top: 12px;
        right: 12px;
      }
      .metric-card {
        border-left: 3px solid;
      }
      .metric-card.cpu { border-color: #206bc4; }
      .metric-card.memory { border-color: #d63939; }
      .metric-card.players { border-color: #2fb344; }
      .metric-card.network { border-color: #f59f00; }
      .status-pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: .5; }
      }
      .game-badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
      }
      .game-minecraft { background: #62a83e20; color: #62a83e; }
      .game-cs2 { background: #f59f0020; color: #f59f00; }
      .game-terraria { background: #17a2b820; color: #17a2b8; }
      .game-gmod { background: #f7670720; color: #f76707; }
      .quick-action-btn {
        width: 40px;
        height: 40px;
        padding: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      .console-preview {
        background: #1e293b;
        color: #94a3b8;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        padding: 12px;
        border-radius: 8px;
        max-height: 120px;
        overflow-y: auto;
      }
      .console-preview::-webkit-scrollbar {
        width: 6px;
      }
      .console-preview::-webkit-scrollbar-thumb {
        background: #475569;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <div class="page">
      <!-- Navbar -->
      <header class="navbar navbar-expand-md navbar-light d-print-none sticky-top">
        <div class="container-xl">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-menu">
            <span class="navbar-toggler-icon"></span>
          </button>
          <h1 class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal pe-0 pe-md-3">
            <a href="/">
              <span class="avatar bg-primary text-white">WTG</span>
              <span class="navbar-brand-text ms-2">WeTheGamers</span>
            </a>
          </h1>
          <div class="navbar-nav flex-row order-md-last">
            <div class="d-none d-md-flex me-3">
              <div class="btn-list">
                <a href="/ads" class="btn btn-ghost-secondary">
                  <i class="ti ti-coin icon"></i>
                  {{.Credits}} GC
                </a>
                {{if .IsPremium}}
                <span class="badge bg-yellow-lt ms-2">
                  <i class="ti ti-star-filled me-1"></i>Premium
                </span>
                {{end}}
              </div>
            </div>
            <div class="nav-item dropdown">
              <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown">
                <span class="avatar avatar-sm" style="background-image: url({{.AvatarURL}})"></span>
                <div class="d-none d-xl-block ps-2">
                  <div>{{.Username}}</div>
                  <div class="mt-1 small text-secondary">{{.Tier}}</div>
                </div>
              </a>
              <div class="dropdown-menu dropdown-menu-end">
                <a href="/profile" class="dropdown-item">
                  <i class="ti ti-user me-2"></i>Profile
                </a>
                <a href="/billing" class="dropdown-item">
                  <i class="ti ti-credit-card me-2"></i>Billing
                </a>
                <a href="/settings" class="dropdown-item">
                  <i class="ti ti-settings me-2"></i>Settings
                </a>
                <div class="dropdown-divider"></div>
                <a href="/logout" class="dropdown-item">
                  <i class="ti ti-logout me-2"></i>Logout
                </a>
              </div>
            </div>
          </div>
        </div>
      </header>
      
      <div class="page-wrapper">
        <!-- Page header -->
        <div class="page-header d-print-none">
          <div class="container-xl">
            <div class="row g-2 align-items-center">
              <div class="col">
                <div class="page-pretitle">
                  <i class="ti ti-clock me-1"></i>Last updated: <span id="last-update">just now</span>
                </div>
                <h2 class="page-title">
                  <i class="ti ti-server-2 me-2"></i>Server Dashboard
                </h2>
              </div>
              <div class="col-auto ms-auto d-print-none">
                <div class="btn-list">
                  <button class="btn btn-ghost-secondary" onclick="refreshData()">
                    <i class="ti ti-refresh icon"></i>
                    Refresh
                  </button>
                  <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal-create-server">
                    <i class="ti ti-plus icon"></i>
                    New Server
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Page body -->
        <div class="page-body">
          <div class="container-xl">
            
            <!-- Real-time Metrics Row -->
            <div class="row row-cards mb-3">
              <div class="col-sm-6 col-xl-3">
                <div class="card metric-card cpu">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <span class="bg-primary-lt text-primary avatar">
                          <i class="ti ti-cpu"></i>
                        </span>
                      </div>
                      <div class="col">
                        <div class="font-weight-medium">Average CPU</div>
                        <div class="text-secondary">
                          <span class="h3 mb-0" id="avg-cpu">{{.AvgCPU}}%</span>
                        </div>
                      </div>
                    </div>
                    <div class="mt-2">
                      <canvas id="cpu-chart" height="40"></canvas>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-xl-3">
                <div class="card metric-card memory">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <span class="bg-red-lt text-red avatar">
                          <i class="ti ti-database"></i>
                        </span>
                      </div>
                      <div class="col">
                        <div class="font-weight-medium">Memory Usage</div>
                        <div class="text-secondary">
                          <span class="h3 mb-0" id="avg-memory">{{.AvgMemory}}%</span>
                        </div>
                      </div>
                    </div>
                    <div class="mt-2">
                      <canvas id="memory-chart" height="40"></canvas>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-xl-3">
                <div class="card metric-card players">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <span class="bg-green-lt text-green avatar">
                          <i class="ti ti-users"></i>
                        </span>
                      </div>
                      <div class="col">
                        <div class="font-weight-medium">Active Players</div>
                        <div class="text-secondary">
                          <span class="h3 mb-0" id="total-players">{{.TotalPlayers}}</span>
                          <span class="text-muted">/ {{.MaxPlayers}}</span>
                        </div>
                      </div>
                    </div>
                    <div class="progress progress-sm mt-2">
                      <div class="progress-bar bg-success" style="width: {{.PlayerPercent}}%"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-xl-3">
                <div class="card metric-card network">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <span class="bg-orange-lt text-orange avatar">
                          <i class="ti ti-network"></i>
                        </span>
                      </div>
                      <div class="col">
                        <div class="font-weight-medium">Network I/O</div>
                        <div class="text-secondary">
                          <span class="h3 mb-0" id="network-io">{{.NetworkIO}}</span>
                          <span class="text-muted">MB/s</span>
                        </div>
                      </div>
                    </div>
                    <div class="mt-2">
                      <canvas id="network-chart" height="40"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Server Cards -->
            <div class="row row-cards">
              {{range .Servers}}
              <div class="col-lg-6">
                <div class="card server-card">
                  <span class="server-status-badge">
                    <span class="badge bg-{{if eq .Status "running"}}success{{else if eq .Status "stopped"}}secondary{{else if eq .Status "creating"}}warning status-pulse{{else}}danger{{end}}">
                      {{.Status}}
                    </span>
                  </span>
                  <div class="card-header">
                    <div class="row align-items-center">
                      <div class="col">
                        <h3 class="card-title">
                          <i class="ti ti-{{if eq .GameType "minecraft"}}pickaxe{{else if eq .GameType "cs2"}}gun{{else if eq .GameType "terraria"}}sword{{else if eq .GameType "gmod"}}tool{{else}}device-gamepad-2{{end}} me-2"></i>
                          {{.Name}}
                        </h3>
                        <div class="card-subtitle">
                          <span class="game-badge game-{{.GameType}}">{{.GameType}}</span>
                          <span class="text-secondary ms-2">ID: {{.ID}}</span>
                        </div>
                      </div>
                      <div class="col-auto">
                        <div class="btn-list">
                          {{if eq .Status "running"}}
                          <button class="btn btn-sm btn-icon btn-success quick-action-btn" onclick="openConsole({{.ID}})" title="Console">
                            <i class="ti ti-terminal"></i>
                          </button>
                          <button class="btn btn-sm btn-icon btn-warning quick-action-btn" onclick="restartServer({{.ID}})" title="Restart">
                            <i class="ti ti-refresh"></i>
                          </button>
                          <button class="btn btn-sm btn-icon btn-danger quick-action-btn" onclick="stopServer({{.ID}})" title="Stop">
                            <i class="ti ti-player-pause"></i>
                          </button>
                          {{else if eq .Status "stopped"}}
                          <button class="btn btn-sm btn-icon btn-success quick-action-btn" onclick="startServer({{.ID}})" title="Start">
                            <i class="ti ti-player-play"></i>
                          </button>
                          <button class="btn btn-sm btn-icon btn-danger quick-action-btn" onclick="deleteServer({{.ID}})" title="Delete">
                            <i class="ti ti-trash"></i>
                          </button>
                          {{end}}
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    {{if .Address}}
                    <div class="mb-3">
                      <div class="row align-items-center">
                        <div class="col">
                          <label class="form-label mb-1">Server Address</label>
                          <div class="input-group input-group-flat">
                            <input type="text" class="form-control font-monospace" value="{{.Address}}:{{.Port}}" readonly>
                            <span class="input-group-text">
                              <button class="btn btn-sm btn-icon" onclick="copyToClipboard('{{.Address}}:{{.Port}}')">
                                <i class="ti ti-copy"></i>
                              </button>
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                    {{end}}

                    <div class="row mb-3">
                      <div class="col-6">
                        <div class="mb-1 text-secondary">
                          <i class="ti ti-coin me-1"></i>Cost Per Hour
                        </div>
                        <div class="h4 mb-0">{{.CostPerHour}} GC</div>
                      </div>
                      <div class="col-6">
                        <div class="mb-1 text-secondary">
                          <i class="ti ti-clock me-1"></i>Uptime
                        </div>
                        <div class="h4 mb-0">{{.Uptime}}</div>
                      </div>
                    </div>

                    {{if eq .Status "running"}}
                    <div class="row mb-3">
                      <div class="col-4">
                        <div class="text-secondary small">CPU</div>
                        <div class="progress progress-sm">
                          <div class="progress-bar bg-primary" style="width: {{.CPU}}%">{{.CPU}}%</div>
                        </div>
                      </div>
                      <div class="col-4">
                        <div class="text-secondary small">RAM</div>
                        <div class="progress progress-sm">
                          <div class="progress-bar bg-red" style="width: {{.Memory}}%">{{.Memory}}%</div>
                        </div>
                      </div>
                      <div class="col-4">
                        <div class="text-secondary small">Players</div>
                        <div class="text-center">{{.Players}}/{{.MaxPlayers}}</div>
                      </div>
                    </div>

                    <!-- Recent Console Output -->
                    <div class="console-preview" id="console-{{.ID}}">
                      {{range .RecentLogs}}
                      <div>{{.}}</div>
                      {{else}}
                      <div class="text-muted">No recent logs...</div>
                      {{end}}
                    </div>
                    {{end}}
                  </div>
                  <div class="card-footer">
                    <div class="row align-items-center">
                      <div class="col">
                        <small class="text-secondary">
                          Created {{.CreatedAt}} • Last synced <span data-server-id="{{.ID}}" class="sync-time">2s ago</span>
                        </small>
                      </div>
                      <div class="col-auto">
                        <a href="/servers/{{.ID}}" class="btn btn-sm">
                          View Details <i class="ti ti-arrow-right ms-1"></i>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              {{else}}
              <div class="col-12">
                <div class="card">
                  <div class="card-body">
                    <div class="empty">
                      <div class="empty-img"><img src="https://tabler.io/demo/static/illustrations/undraw_server_down_s-4-lk.svg" height="128" alt=""></div>
                      <p class="empty-title">No servers running</p>
                      <p class="empty-subtitle text-secondary">
                        Deploy your first game server in seconds
                      </p>
                      <div class="empty-action">
                        <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal-create-server">
                          <i class="ti ti-plus icon"></i>
                          Create Your First Server
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              {{end}}
            </div>

            <!-- Activity Timeline -->
            {{if .RecentActivity}}
            <div class="row mt-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <h3 class="card-title">Recent Activity</h3>
                  </div>
                  <div class="card-body">
                    <div class="timeline">
                      {{range .RecentActivity}}
                      <div class="timeline-item">
                        <div class="timeline-badge bg-{{.Type}}"></div>
                        <div class="timeline-content">
                          <div class="timeline-title">{{.Action}}</div>
                          <div class="timeline-subtitle text-secondary">{{.Server}} • {{.Time}}</div>
                        </div>
                      </div>
                      {{end}}
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {{end}}

          </div>
        </div>

        <!-- Footer -->
        <footer class="footer footer-transparent d-print-none">
          <div class="container-xl">
            <div class="row text-center align-items-center">
              <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                <ul class="list-inline list-inline-dots mb-0">
                  <li class="list-inline-item">
                    <i class="ti ti-server text-green"></i> All systems operational
                  </li>
                  <li class="list-inline-item">
                    Copyright &copy; 2025 WeTheGamers
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>

    <!-- Create Server Modal -->
    <div class="modal modal-blur fade" id="modal-create-server" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Create New Game Server</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="create-server-form">
              <div class="row mb-3">
                <div class="col-12">
                  <label class="form-label required">Select Game</label>
                  <div class="row g-2">
                    <div class="col-6 col-md-3">
                      <label class="form-selectgroup-item">
                        <input type="radio" name="game_type" value="minecraft" class="form-selectgroup-input" required>
                        <span class="form-selectgroup-label d-flex align-items-center p-3">
                          <span class="me-3">
                            <span class="form-selectgroup-check"></span>
                          </span>
                          <span class="form-selectgroup-label-content">
                            <span class="d-block mb-1">Minecraft</span>
                            <span class="text-secondary small">5 GC/hr</span>
                          </span>
                        </span>
                      </label>
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="form-selectgroup-item">
                        <input type="radio" name="game_type" value="cs2" class="form-selectgroup-input">
                        <span class="form-selectgroup-label d-flex align-items-center p-3">
                          <span class="me-3">
                            <span class="form-selectgroup-check"></span>
                          </span>
                          <span class="form-selectgroup-label-content">
                            <span class="d-block mb-1">CS2</span>
                            <span class="text-secondary small">8 GC/hr</span>
                          </span>
                        </span>
                      </label>
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="form-selectgroup-item">
                        <input type="radio" name="game_type" value="terraria" class="form-selectgroup-input">
                        <span class="form-selectgroup-label d-flex align-items-center p-3">
                          <span class="me-3">
                            <span class="form-selectgroup-check"></span>
                          </span>
                          <span class="form-selectgroup-label-content">
                            <span class="d-block mb-1">Terraria</span>
                            <span class="text-secondary small">3 GC/hr</span>
                          </span>
                        </span>
                      </label>
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="form-selectgroup-item">
                        <input type="radio" name="game_type" value="gmod" class="form-selectgroup-input">
                        <span class="form-selectgroup-label d-flex align-items-center p-3">
                          <span class="me-3">
                            <span class="form-selectgroup-check"></span>
                          </span>
                          <span class="form-selectgroup-label-content">
                            <span class="d-block mb-1">GMod</span>
                            <span class="text-secondary small">6 GC/hr</span>
                          </span>
                        </span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label required">Server Name</label>
                <input type="text" class="form-control" name="name" placeholder="my-awesome-server" required>
                <small class="form-hint">Use lowercase letters, numbers, and hyphens</small>
              </div>
              <div class="mb-3">
                <label class="form-label">Description</label>
                <textarea class="form-control" name="description" rows="2" placeholder="A fun server for friends"></textarea>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Max Players</label>
                    <input type="number" class="form-control" name="max_players" value="20" min="1" max="100">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Region</label>
                    <select class="form-select" name="region">
                      <option value="us-east">US East</option>
                      <option value="us-west">US West</option>
                      <option value="eu-west">EU West</option>
                      <option value="asia">Asia</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" name="is_public" id="switch-public">
                <label class="form-check-label" for="switch-public">List in public server browser</label>
              </div>
              <div class="alert alert-info mb-0">
                <div class="d-flex">
                  <div>
                    <i class="ti ti-info-circle"></i>
                  </div>
                  <div class="ms-3">
                    <h4 class="alert-title">Current Balance</h4>
                    <div class="text-secondary">You have <strong>{{.Credits}} GC</strong> available</div>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-link link-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="createServer()">
              <i class="ti ti-rocket me-2"></i>Deploy Server
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabler JS -->
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/js/tabler.min.js"></script>
    <script>
      // Real-time data updates
      let cpuData = [];
      let memoryData = [];
      let networkData = [];
      
      function initCharts() {
        const chartConfig = {
          type: 'line',
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              x: { display: false },
              y: { display: false, min: 0, max: 100 }
            },
            elements: {
              line: { borderWidth: 2, tension: 0.4 },
              point: { radius: 0 }
            }
          }
        };

        // CPU Chart
        new Chart(document.getElementById('cpu-chart'), {
          ...chartConfig,
          data: {
            labels: Array(20).fill(''),
            datasets: [{
              data: cpuData,
              borderColor: '#206bc4',
              backgroundColor: 'rgba(32, 107, 196, 0.1)'
            }]
          }
        });

        // Similar for memory and network charts...
      }

      function copyToClipboard(text) {
        navigator.clipboard.writeText(text);
        // Show toast notification
        console.log('Copied:', text);
      }

      function refreshData() {
        // Fetch updated metrics from API
        fetch('/api/v1/servers')
          .then(res => res.json())
          .then(data => {
            // Update UI with fresh data
            document.getElementById('last-update').textContent = 'just now';
          });
      }

      function openConsole(id) {
        window.location.href = `/servers/${id}/console`;
      }

      function createServer() {
        const form = document.getElementById('create-server-form');
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        
        fetch('/api/v1/servers', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          },
          body: JSON.stringify(data)
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            window.location.reload();
          }
        });
      }

      function startServer(id) {
        if (!confirm('Start this server?')) return;
        fetch(`/api/v1/servers/${id}/start`, {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
        }).then(() => window.location.reload());
      }

      function stopServer(id) {
        if (!confirm('Stop this server?')) return;
        fetch(`/api/v1/servers/${id}/stop`, {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
        }).then(() => window.location.reload());
      }

      function restartServer(id) {
        if (!confirm('Restart this server?')) return;
        fetch(`/api/v1/servers/${id}/restart`, {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
        }).then(() => window.location.reload());
      }

      function deleteServer(id) {
        if (!confirm('Delete this server permanently?')) return;
        fetch(`/api/v1/servers/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
        }).then(() => window.location.reload());
      }

      // Initialize on load
      document.addEventListener('DOMContentLoaded', () => {
        initCharts();
        // Auto-refresh every 10 seconds
        setInterval(refreshData, 10000);
      });
    </script>
  </body>
</html>
